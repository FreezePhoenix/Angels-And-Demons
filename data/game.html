<html>
  <head>
    <script src="https://npmcdn.com/vue/dist/vue.js"></script>
    <title>Angles & Demons</title>
    <style>
      body {
        background-color: #222222
      }
      div {
        display: inline-block;
        clear: none
      }
      .manaBar  {
        height:20px;
        background-color: Blue;
        color: White;
      }
      .tag {
        height:20px;
        color: white;
        padding: 3px;
        border-radius:4px;
        text-align: center;
        margin: 0 auto;
      }
      .tag.manaCost {
        background-color: MediumBlue;
      }
      .tag.attack {
        background-color: DarkRed;
      }
      .tag.manaPerRound {
        background-color: Blue
      }
      table {
        display: inline-table;
        width: 100%;
      }
      .card {
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div id="game" style="display:block">
      <table width="100%">
        <tr>
          <td>
            <div style="background-color:#FFFFFF; width:100px; height:20px">
              <div class="manaBar" v-bind:style="{height:'20px',width: data.playerMana.manaBarWidth, color:'white'}" align="center"> {{ data.playerMana.mana }} </div>
            </div>
          </td>
          <td></td>
          <td></td>
          <td>
            <div style="float:right; background-color:#FFFFFF; width:100px; height:20px">
              <div class="manaBar" v-bind:style="{'float':'right', width: data.enemyMana.manaBarWidth, 'background-color': 'blue', color:'white'}" align="center"> {{ data.enemyMana.mana }} </div>
            </div>
          </td>
        </tr>
        <tr>
          <td id="playerHand">
            <div style="align:right; width:100px">
              <table id="playerHand">
                <tr v-for="item in data.playerHand">
                  <td style="width:100px">
                    <div class="card">
                      <div class="name" v-bind:style="{color: item.nameColor, 'text-align': 'center'}" class="cardName" :onclick="'playerHand.cards['+item.ID+'].summon()'">{{item.name}}</div>
                      <br>
                      <div class="tag manaCost"> {{ item.summonCost }} </div>
                      <div class="tag attack"> {{ item.attack }} </div>
                      <div class="tag manaPerRound"> {{ item.manaPerTurn }} </div>
                    </div>
                  </td>
                </tr>
              </table>
            </div>
          </td>
          <td id="Player">
            <div style="align:center; width:100px">
              <table id="playerUnits">
                <tr v-for="item in data.playerCards">
                  <td style="width:100px">
                    <div class="card">
                      <div class="tag" v-bind:style="{width:'100px',color: item.selected ? data.lighterColors[item.nameColor] : (item.locked ? data.darkerColors[item.nameColor] : item.nameColor)}" :onclick="'playerDeck.cards['+item.ID+'].onclick()'" align="center">{{item.name}}</div>
                      <br v-if="item.health">
                      <div v-if="item.health" style="background-color:black; width:100px; height:20px">
                        <div v-bind:style="item.style" align="center"> {{item.health}} </div>
                      </div>
                      <br>
                      <div class="tag manaCost"> {{ item.manaCost }} </div>
                      <div class="tag attack"> {{ item.attack }} </div>
                      <div class="tag manaPerRound"> {{ item.manaPerTurn }} </div>
                    </div>
                  </td>
                </tr>
              </table>
            </div>
          </td>
          <td>
            <button onclick="nextTurn()">End turn.</button>
          </td>
          <td id="Enemy"> 
            <div style="float:right">
              <table id="enemyUnits">
                <tr v-for="item in data.enemyCards">
                  <td style="width:100px;">
                    <div class="card">
                      <div class="tag" v-bind:style="{width:'100px',color: item.selected ? data.lighterColors[item.nameColor] : (item.locked ? data.darkerColors[item.nameColor] : item.nameColor)}" :onclick="'enemyDeck.cards['+item.ID+'].onclick()'" align="center">{{item.name}}</div>
                      <br v-if="item.health">
                      <div v-if="item.health" style="background-color:black; width:100px; height:20px">
                        <div v-bind:style="item.style" align="center"> {{item.health}} </div>
                      </div>
                      <br>
                      <div class="tag manaCost"> {{ item.manaCost }} </div>
                      <div class="tag attack"> {{ item.attack }} </div>
                      <div class="tag manaPerRound"> {{ item.manaPerTurn }} </div>
                    </div>
                  <td>
                </tr>
              </table>
            </div>
          </td>
          <td id="enemyHand">
            <div style="align:right; float:right; width:100px">
              <table id="enemyHand" style="width:100px">
                <tr v-for="item in data.enemyHand">
                  <td style="width:100px">
                    <div class="card">
                      <div class="name" v-bind:style="{'width':'100%',color: item.nameColor, 'text-align': 'center'}" class="cardName" :onclick="'enemyHand.cards['+item.ID+'].summon()'">{{item.name}}</div>
                      <br>
                      <div class="tag manaCost"> {{ item.summonCost }} </div>
                      <div class="tag attack"> {{ item.attack }} </div>
                      <div class="tag manaPerRound"> {{ item.manaPerTurn }} </div>
                    </div>
                  </td>
                </tr>
              </table>
            </div>
          </td>
      </table>
    </div>
    <script>
      function nextTurn(){
        Turn++
        if(Turn%2 === 0) {
          var newEnemyMana = enemyDeck.manaManager.mana + enemyDeck.manaManager.manaPerTurn,
              newPlayerMana = playerDeck.manaManager.mana + playerDeck.manaManager.manaPerTurn
          enemyDeck.manaManager.mana = newEnemyMana > enemyDeck.manaManager.maxMana ? enemyDeck.manaManager.maxMana : newEnemyMana
          playerDeck.manaManager.mana = newPlayerMana > playerDeck.manaManager.maxMana ? playerDeck.manaManager.maxMana : newPlayerMana
        }
        Object.keys(playerDeck.cards).map(i=>playerDeck.cards[i].ID).forEach((cardID)=> {
          playerDeck.cards[cardID].used = false
          playerDeck.cards[cardID].selected = false
          playerDeck.cards[cardID].locked = false
          playerDeck.IDofCardSelected = -1
        })
        Object.keys(enemyDeck.cards).map(i=>enemyDeck.cards[i].ID).forEach((cardID)=> {
          enemyDeck.cards[cardID].used = false
          enemyDeck.cards[cardID].selected = false
          enemyDeck.cards[cardID].locked = false
          enemyDeck.IDofCardSelected = -1
        })
      }
      var DarkerColors = {
        "Gold": "GoldenRod",
        "LightSteelBlue": "SteelBlue",
        "Silver": "DarkGrey"
      }
      var LighterColors = {
        "Gold": "Yellow",
        "LightSteelBlue": "LightSkyBlue",
        "Silver": "LightGrey"
      }
      var Turn = 0
      class Deck {
        constructor(isHand, manaManager){
          this.cards = {};
          this.currentId = 0;
          this.isHand = isHand;
          this.manaManager = manaManager;
          this.enemy = [];
          this.IDofCardSelected = -1
        }
        enableEnemyDeck(){
          this.enemyDeck.ArrayOfCardIDs.forEach( (cardID) => {
            this.enemyDeck.cards[cardID].locked = false;
          });
        }
        disableEnemyDeck(){
          this.enemyDeck.ArrayOfCardIDs.forEach( (cardID) => {
            this.enemyDeck.cards[cardID].locked = true;
          });
        }
        get ArrayOfCards(){
          return Object.keys(this.cards).map(ID=>this.cards[ID])
        }
        get ArrayOfCardIDs(){
          return Object.keys(this.cards)
        }
        attack(){
          var opponentCardID = this.enemyDeck.IDofCardSelected
          var yourCardID = this.IDofCardSelected
          if(yourCardID+1 && opponentCardID+1 && !this.enemyDeck.cards[opponentCardID].used){  // the opponent is always the person who attacks.
            this.enemyDeck.cards[opponentCardID].health -= this.cards[yourCardID].attack
            this.cards[yourCardID].health -= this.enemyDeck.cards[opponentCardID].attack
            this.enemyDeck.cards[opponentCardID].used = true
            this.enemyDeck.cards[opponentCardID].selected = false
            this.enemyDeck.IDofCardSelected = -1
            this.IDofCardSelected = -1
            this.enemyDeck.manaManager.mana -= this.enemyDeck.cards[opponentCardID].manaCost
            this.ArrayOfCards.forEach( (card) => {
              if( card.health <= 0 ) {
                this.removeCards(card)
              }
            })
          }
        }
        addCards(...cards){
          cards.forEach( (card)=>{
            this.isHand ? card.inHand = true : false;
            card.ID = this.currentId;;
            this.cards[this.currentId] = card;
            this.currentId++;
          });
        }
        removeCards(...cards){
          cards.forEach((card)=>{
            delete this.cards[card.ID]
          });
        }
        Lockdown(...cards){
          console.log(this)
          Object.keys(this.cards).map(i=>this.cards[i].id).forEach( (cardID) => {
            this.cards[cardID].locked = true;
            this.cards[cardID].selected = false;
          });
          cards.forEach( (item) => {
            this.cards[item.ID].locked = false;
          });
        }
        OpenUp(){
          Object.keys(this.cards).map(i=>this.cards[i].ID).forEach( (cardID) => {
            this.cards[cardID].locked = false;
          });
        }
      }
      class Card {
        constructor(maxHealth, attack, nameColor, manaCost, name, inHand, hand, deck, manaPerTurn){
          this.health = maxHealth
          this.maxHealth = maxHealth
          this.attack = attack
          this.selected = false
          this.nameColor = nameColor
          this.manaCost = manaCost
          this.name = name
          this.inHand = inHand
          this.deck = deck
          this.manaManager = deck.manaManager
          this.manaPerTurn = manaPerTurn
          this.hand = hand
          this.decks = [playerDeck, enemyDeck]
          this.locked = false
          this.used = false
        }
        onclick() {
          console.log(Turn % 2 == !this.decks.indexOf(this.deck))
          if(this.manaManager.mana >= (this.manaCost === "N/A" ? 0 : this.manaCost) && !(this instanceof Land)) {
            if(Turn % 2 == this.decks.indexOf(this.deck)) {
              if(!this.selected){
                this.deck.Lockdown(this);
                this.toggleSelected();
                this.deck.enableEnemyDeck();
                this.deck.IDofCardSelected = this.ID;
              } else if ( this.selected ) {
                this.toggleSelected();
                this.deck.OpenUp();
                this.deck.disableEnemyDeck();
                this.deck.IDofCardSelected = -1;
              };
            } else if(Turn % 2 == !this.decks.indexOf(this.deck)) {
              this.deck.IDofCardSelected = this.ID;
              this.deck.attack();
              this.deck.enemyDeck.OpenUp();
            } 
          } 
        }
        summon() {
          if( Turn % 2 === this.decks.indexOf(this.deck) ) {
            if( confirm('Are you sure you want to summon this card?') ) {
              this.hand.manaManager.mana -= this.summonCost == "N/A" ? 0 : this.summonCost;
              delete this.hand.cards[this.id];
              this.deck.addCards(this);
              this.inHand = false;
              this.used = true; // summoning sickness.
            };
        }
      }
      toggleSelected(){
        this.selected = !this.selected;
      }
      get style(){
        return `width: ${this.health / this.maxHealth * 100}; background-color: ${this.barColor}; height: 20px`
      }
      get barColor(){
        var r = 255 - (this.health/this.maxHealth) * 255;
        var g = (this.health/this.maxHealth) * 255;
        return `rgb(${Math.floor(r)}, ${Math.floor(g)}, 0)`;
      }
      get id(){
        // this is for me when i don't feel like hitting the shift key like i do right now.
        return this.ID;
      }
      }
      class ManaManager {
        constructor(deck){
          this.mana = 20;
          this.deck = deck;
        }
        get maxMana(){
          return 20 + Object.keys(this.deck.cards).map((item)=>{return this.deck.cards[item]}).map(function(i){return i instanceof Land}).filter(Boolean).length 
        }
        get manaBarWidth() {
          return Math.floor(this.mana/this.maxMana*100);
        }
        get manaPerTurn(){
          var result = 0
          Object.keys(this.deck.cards).map(i=>this.deck.cards[i]).forEach((card)=> {
            result += card.manaPerTurn == "N/A" ? 0 : card.manaPerTurn;
          });
          return result;
        }
      }
      class Land extends Card{
        constructor(manaPerTurn, name, nameColor, inHand, hand, deck){
          super(null, "N/A", nameColor, "N/A", name,deck.isHand, hand, deck, manaPerTurn);
          this.summonCost = 0
        }
      }
      class Stone extends Land {
        constructor(hand, deck, name) {
          super(1, name, 'LightSteelBlue', deck.isHand, hand, deck);
        }
      }
      class Mountain extends Stone {
        constructor(hand, deck){
          super(hand, deck, "Mountain");
        }
      }
      class Ravine extends Stone {
        constructor(hand, deck){
          super(hand, deck, "Ravine");
        }
      }
      class PlayerUnit extends Card {
        constructor(summonCost, maxHealth, attack, nameColor, name, manaCost, hand=playerHand, deck=playerDeck, manaPerTurn="N/A",manaManager=playerManaManager, inHand=false){
          maxHealth = maxHealth || 20;
          super(maxHealth, attack, nameColor, manaCost, name, inHand, hand, deck, manaPerTurn);
          this.summonCost = summonCost || 0
        }
      }
      class EnemyUnit extends Card {
        constructor(summonCost, maxHealth, attack, nameColor, name, manaCost, hand=enemyHand, deck=enemyDeck, manaPerTurn="N/A", manaManager=enemyManaManager, inHand=false){
          super(maxHealth, attack, nameColor, manaCost, name, inHand, hand, deck, manaPerTurn);
          this.summonCost = summonCost
        }
      }
      class Angel extends PlayerUnit {
        constructor(hand, deck){
          super(10, 100, 10, "Gold", "Angel", 7, hand, deck);
        }
      }
      class Paladin extends PlayerUnit {
        constructor(hand, deck) {
          super(5, 60, 5, "Silver", "Paladin", 4, hand, deck);
        }
      }
      class Demon extends EnemyUnit {
        constructor(hand, deck){
          super(10, 100, 10, "Gold", "Demon", 7, hand, deck);
        }
      }
      class HellHound extends EnemyUnit {
        constructor(hand, deck){
          super(5, 60, 5, "Silver", "Hell Hound", 4, hand, deck);
        }
      }
      var playerDeck = new Deck(false),
          enemyDeck = new Deck(false),
          enemyHand = new Deck(true, new ManaManager(enemyDeck)),
          playerHand = new Deck(true, new ManaManager(playerDeck)),
          playerManaManager = playerHand.manaManager,
          enemyManaManager = enemyHand.manaManager;
      playerDeck.manaManager = playerManaManager;
      enemyDeck.manaManager = enemyManaManager;
      playerDeck.enemyDeck = enemyDeck;
      enemyDeck.enemyDeck = playerDeck;
      playerDeck.addCards(new Paladin);
      playerHand.addCards(new Mountain(playerHand, playerDeck), new Angel);
      enemyDeck.addCards(new Demon());
      enemyHand.addCards(new Ravine(enemyHand, enemyDeck));
      new Vue({
        el: "#game",
        data: {
          data: {
            playerCards: playerDeck.cards,
            enemyCards: enemyDeck.cards,
            playerHand: playerHand.cards,
            enemyHand: enemyHand.cards,

            playerMana: playerManaManager,
            enemyMana: enemyManaManager,

            darkerColors: DarkerColors,
            lighterColors: LighterColors
          }
        }
      });
    </script>
  </body>
</html>
